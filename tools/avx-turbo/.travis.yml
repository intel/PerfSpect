dist: xenial
language: cpp
sudo: false
branches:
  except:
    - /^(wip\/)?(appveyor|msvc|mingw|windows)(\-.+)?$/

addons:
  apt:
    sources: &default_sources
      - ubuntu-toolchain-r-test

# the anchors element doesn't do anything but itself except define some anchors to be used later as aliases
anchors:
  - &unit_command ./unit-test
  - &uarch_command ./uarch-bench --test-tag=~slow

matrix:
  include:
      # clang-5.0 is the default installed on travis VMs
    - compiler: clang-default
      env: TRUE_CC=clang TRUE_CXX=clang++ CXXFLAGS=-stdlib=libc++
      addons:
        apt:
          sources:
            - *default_sources
            - llvm-toolchain-trusty-5.0
          packages:
            - libc++abi1
            - libc++1
    - compiler: gcc-4.9
      env: TRUE_CC=gcc-4.9 TRUE_CXX=g++-4.9
      addons:
        apt:
          sources:
            - *default_sources
          packages:
            - gcc-4.9
            - g++-4.9
    - compiler: gcc-6
      env: TRUE_CC=gcc-6 TRUE_CXX=g++-6
      addons:
        apt:
          sources:
            - *default_sources
          packages:
            - gcc-6
            - g++-6
    - compiler: clang-6.0
      env: TRUE_CC=clang-6.0 TRUE_CXX=clang++-6.0
      addons:
        apt:
          sources:
            - *default_sources
            - llvm-toolchain-xenial-6.0
          packages:
            - clang-6.0
            - clang++-6.0

before_install:
# Travis will set CC and CXX after the env commands specified in the matrix are run, overwriting whatever
# we've specified there, so we need to reset them here. See also https://github.com/travis-ci/travis-ci/issues/6633 .
  - CC="${TRUE_CC:-$CC}"
  - CXX="${TRUE_CXX:-$CXX}"


script:
- set -e && echo "CC is ${CC}, CXX is ${CXX}" && ${CC} --version && ${CXX} --version
- make
- ./avx-turbo --no-pin --max-threads 2
